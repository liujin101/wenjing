<!DOCTYPE HTML>
<html>
<head>
    <!--Setting-->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta name="apple-mobile-web-app-capable"  content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no,email=no">
    <link rel="dns-prefetch" href="//t11.baidu.com">
    <!--SEO-->

<meta name="description" content="时光荏苒须当惜，风雨阴晴勤值历。"/>



<meta name="robots" content="all" />
<meta name="google" content="all" />
<meta name="googlebot" content="all" />
<meta name="verify" content="all" />
    <!--Title-->


<title>图片预览功能--兼容IE | 文井の博客</title>


    <link rel="alternate" href="/atom.xml" title="文井の博客" type="application/atom+xml">


    <link rel="icon" href="/favicon.ico">

    




    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css?rev=9.12.0">


<link rel="stylesheet" href="//cdn.bootcss.com/bootstrap/3.3.4/css/bootstrap.min.css?rev=3.3.4">
<link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="/wenjing/css/style.css?rev=@@hash">




    
    <div class="hide">
    <script src="https://s4.cnzz.com/z_stat.php?id=1261768793&web_id=1263868967" language="JavaScript"></script>
    </div>



    
    
</head>


<!--[if lte IE 8]>
<style>
    html{ font-size: 1em }
</style>
<![endif]-->
<!--[if lte IE 9]>
<div style="ie">你使用的浏览器版本过低，为了你更好的阅读体验，请更新浏览器的版本或者使用其他现代浏览器，比如Chrome、Firefox、Safari等。</div>
<![endif]-->

<body>
    <header class="main-header">
    <div class="main-header-box">
        <a class="branding" href="/" title="">
            <img src="/wenjing/img/header_logo.png" alt="Snippet 博客主题">
        </a>
        <h2 class="text-hide">Snippet主题</h2>
        <img src="/wenjing/img/header_logo.png" alt="Snippet 博客主题" class="hide">
    </div>
</header>
    <nav class="main-navigation">
    <div class="container">
        <div class="row">
            <div class="col-sm-12">
                <div class="navbar-header"><span class="nav-toggle-button collapsed" data-toggle="collapse" data-target="#main-menu" id="mnav">
                    <span class="sr-only">Toggle navigation</span>
                    <i class="fa fa-bars"></i>
                    </span>
                </div>
                <div class="collapse navbar-collapse" id="main-menu">
                    <ul class="menu">
                        
                            <li role="presentation" class=""><a href="/wenjing">主页</a></li>
                        
                            <li role="presentation" class=""><a href="/wenjing/categories/fe/">前端</a></li>
                        
                            <li role="presentation" class=""><a href="/wenjing/categories/be/">后端</a></li>
                        
                            <li role="presentation" class=""><a href="/wenjing/categories/se/">资源</a></li>
                        
                            <li role="presentation" class=""><a href="/wenjing/categories/ie/">随笔</a></li>
                        
                    </ul>
                </div>
            </div>
        </div>
    </div>
</nav>
    <section class="content-wrap">
        <div class="container">
            <div class="row">
                <main class="col-md-8 main-content">
                    <p id="process"></p>
<article class="post">
    <div class="post-head">
        <h1 id="图片预览功能--兼容IE">
            
            图片预览功能--兼容IE
            
        </h1>
        <div class="post-meta">
    
    
    <span class="categories-meta fa-wrap">
        <i class="fa fa-folder-open-o"></i>
        <span>前端</span>
    </span>
    
    
    <span class="fa-wrap">
        <i class="fa fa-tags"></i>
        <span class="tags-meta">
            
            前端
            
        </span>
    </span>
    
    
    <span class="fa-wrap">
        <i class="fa fa-clock-o"></i>
        <span class="date-meta">2017/09/23</span>
    </span>
</div>

            
            
    </div>
    
    <div class="post-body">
        <h1 id="图片预览功能–兼容IE"><a href="#图片预览功能–兼容IE" class="headerlink" title="图片预览功能–兼容IE"></a>图片预览功能–兼容IE</h1><p>2017/9/23 9:26:01 </p>
<hr>
<h2 id="功能要求以及遇到的几个问题"><a href="#功能要求以及遇到的几个问题" class="headerlink" title="功能要求以及遇到的几个问题"></a>功能要求以及遇到的几个问题</h2><p>1、用户上传图片前预览图片，确定是否选取正确，此时可以对不满意的图片进行删除。<br>2、要求兼容IE低版本浏览器，因此必须使用滤镜。<br>3、由于后台在设计时是没有考虑兼容性的，因此使用的是HTML5中的formDate对象来作为数据传输的传媒，IE9及以下版本无法传输数据至后台。<br>4、IE浏览器基于安全性的考虑禁止使用JavaScript对input元素进行模拟点击事件的操作，因此在利用BootScript框架中的美化文件上传样式时，在IE浏览器中上传的文件格式错误。<br>5、最开始接手项目时没有与后台进行沟通交流，选取的是百度开发团队维护的一个图片预览上传插件（Webuploader）进行开发，预览功能可以很好的实现，但是由于Webuploader采取的是将图片转换为Base64编码格式的数据后再在页面上显示出来，后台也是采用PHP来接收数据，因此完全是不能用，只好丢掉重来。</p>
<h2 id="最终采用的代码以及注释"><a href="#最终采用的代码以及注释" class="headerlink" title="最终采用的代码以及注释"></a>最终采用的代码以及注释</h2><pre><code>&lt;!DOCTYPE html&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;meta charset=&quot;UTF-8&quot;&gt;
        &lt;title&gt;&lt;/title&gt;
        &lt;style type=&quot;text/css&quot;&gt;
   #add-img{
            background: #0094FF;
            color: white;
            border: none;
            outline: none;
            width: 100px;
            line-height: 24px;
            position: absolute;
            bottom: 5px;
            left: 320px;
            border-radius: 10px;
        }
        .click-check-img{
            border-radius: 10px;
            background: #0094FF;
            color: white;
            border: none;
            outline: none;
            width: 100px;
            line-height: 24px;
        }
        #add-img:hover{
            cursor: pointer;
            background: #0084ff;
        }
        .preview{

            width: 120px;
            height:180px;
            display: inline-block;
            position: relative;
            margin: 0 20px;

        }        
        #uploadfiledemoform{
            border: 1px solid #CCCCCC;
            border-radius: 5px;
            width: 740px;
            padding-left: 60px;
            padding-bottom: 25px;
            margin: auto;
            margin-bottom: 10px;
            position: relative;
            margin-top: 10px;
            padding-top: 10px;
        }
        .preview .del{
            display: none;
            width: 20px;
            height: 20px;
            border: none;
            outline: none;
            position: absolute;
            right: 0;
            top: 0;
            background: url(icons.png) top right;
        }
        .del:hover{
            cursor: pointer;
        }
        .file{                        

            opacity: 0;
            position: absolute;
            font-size: 16px;
            width: 110px;
            /*使用滤镜解决ie浏览器不支持file按钮的opacity*/
            filter: progid:DXImageTransform.Microsoft.Alpha(opacity=0);            
        }
        .file:hover{
            cursor: pointer;
        }
        #uploadfiledemoform img{
            margin-bottom: 5px;
        }
&lt;/style&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;form enctype=&quot;multipart/form-data&quot; id=&quot;uploadfiledemoform&quot; method=&quot;post&quot;&gt;
    &lt;div class=&quot;preview&quot;&gt;
        &lt;input type=&quot;button&quot; class=&quot;del&quot; /&gt;
        &lt;div id=&quot;imgdiv&quot;&gt;&lt;img id=&quot;imgShow&quot; width=&quot;100&quot; height=&quot;100&quot; src=&quot;&quot; /&gt;&lt;/div&gt;
        &lt;input type=&quot;file&quot; class=&quot;file&quot; id=&quot;up_img&quot; name=&quot;file&quot; /&gt;
        &lt;input type=&quot;button&quot; class=&quot;btn btn-primary click-check-img&quot;&quot; value=&quot;点击选择图片&quot; /&gt;

    &lt;/div&gt;

    &lt;input id=&apos;add-img&apos; class=&quot;btn btn-primary&quot; type=&quot;button&quot; value=&quot;继续添加&quot; /&gt;

&lt;/form&gt;
    &lt;/body&gt;
    &lt;script src=&quot;jquery-1.9.1.min.js&quot; type=&quot;text/javascript&quot; charset=&quot;utf-8&quot;&gt;&lt;/script&gt;

    &lt;script&gt;

 $(function(){
//     *work:图片预览方法
var uploadPreview = function(setting) {

    var _self = this;

    _self.IsNull = function(value) {
        if (typeof (value) == &quot;function&quot;) { return false; }
        if (value == undefined || value == null || value == &quot;&quot; || value.length == 0) {
            return true;
        }
        return false;
    }

    _self.DefautlSetting = {
        UpBtn: &quot;&quot;,
        DivShow: &quot;&quot;,
        ImgShow: &quot;&quot;,
        Width: 100,
        Height: 100,
        ImgType: [&quot;gif&quot;, &quot;jpeg&quot;, &quot;jpg&quot;, &quot;bmp&quot;, &quot;png&quot;],
        ErrMsg: &quot;选择文件错误,图片类型必须是(gif,jpeg,jpg,bmp,png)中的一种&quot;,
        callback: function() { }
    };

    _self.Setting = {
        UpBtn: _self.IsNull(setting.UpBtn) ? _self.DefautlSetting.UpBtn : setting.UpBtn,
        DivShow: _self.IsNull(setting.DivShow) ? _self.DefautlSetting.DivShow : setting.DivShow,
        ImgShow: _self.IsNull(setting.ImgShow) ? _self.DefautlSetting.ImgShow : setting.ImgShow,
        Width: _self.IsNull(setting.Width) ? _self.DefautlSetting.Width : setting.Width,
        Height: _self.IsNull(setting.Height) ? _self.DefautlSetting.Height : setting.Height,
        ImgType: _self.IsNull(setting.ImgType) ? _self.DefautlSetting.ImgType : setting.ImgType,
        ErrMsg: _self.IsNull(setting.ErrMsg) ? _self.DefautlSetting.ErrMsg : setting.ErrMsg,
        callback: _self.IsNull(setting.callback) ? _self.DefautlSetting.callback : setting.callback
    };

    _self.getObjectURL = function(file) {
        var url = null;
        if (window.createObjectURL != undefined) {
            url = window.createObjectURL(file);
        } else if (window.URL != undefined) {
            url = window.URL.createObjectURL(file);
        } else if (window.webkitURL != undefined) {
            url = window.webkitURL.createObjectURL(file);
        }
        return url;
    }

    _self.Bind = function() {
        document.getElementById(_self.Setting.UpBtn).onchange = function() {
            $(this).prev().hover(function(){
                $(this).prev().show();
            });

            if (this.value) {
                if (!RegExp(&quot;\.(&quot; + _self.Setting.ImgType.join(&quot;|&quot;) + &quot;)$&quot;, &quot;i&quot;).test(this.value.toLowerCase())) {
                    alert(_self.Setting.ErrMsg);
                    this.value = &quot;&quot;;
                    return false;
                }
                if (navigator.userAgent.indexOf(&quot;MSIE&quot;) &gt; -1) {
                    try {
                        document.getElementById(_self.Setting.ImgShow).src = _self.getObjectURL(this.files[0]);
                    } catch (e) {
                        var div = document.getElementById(_self.Setting.DivShow);
                        this.select();
                        top.parent.document.body.focus();
                        var src = document.selection.createRange().text;
                        document.selection.empty();
                        document.getElementById(_self.Setting.ImgShow).style.display = &quot;none&quot;;
                        div.style.filter = &quot;progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod=scale)&quot;;
                        div.style.width = _self.Setting.Width + &quot;px&quot;;
                        div.style.height = _self.Setting.Height + &quot;px&quot;;
                        div.filters.item(&quot;DXImageTransform.Microsoft.AlphaImageLoader&quot;).src = src;
                    }
                } else {
                    document.getElementById(_self.Setting.ImgShow).src = _self.getObjectURL(this.files[0]);
                }
                _self.Setting.callback();
            }
        }
    }

    _self.Bind();
}
     //图片预览方法结束    
     //用户进入页面后实例化：
     new uploadPreview({ UpBtn: &quot;up_img&quot;, DivShow: &quot;imgdiv&quot;, ImgShow: &quot;imgShow&quot; });
     //用户选取第一个文件上传按钮后自动生成下一个按钮：
     var $preview = $(&quot;.preview&quot;).last().children(&quot;div&quot;).children(&quot;img&quot;);
     var imgDivId = 0;
     var imgShowId = 0;
     var fileId = 0;
     var count = 1;

     $(document).on(&quot;click&quot;,&quot;.preview .del&quot;,function(){                             
            $(this).parent().remove();
            count--;
            //当用户删除掉所有选择的图片时再生成一个空白的选择按钮并为该按钮添加图片预览功能：
            if(count == 0){
                $(&apos;&lt;div class=&quot;preview&quot;&gt;&lt;input type=&quot;button&quot; class=&quot;del&quot; /&gt;&lt;div id=&quot;imgdiv&apos;+ imgDivId +&apos;&quot;&gt;&lt;img id=&quot;imgShow&apos;+ imgShowId +&apos;&quot; width=&quot;100&quot; height=&quot;100&quot; /&gt;&lt;/div&gt;&lt;input  class=&quot;file&quot;  name=&quot;file&quot; type=&quot;file&quot; id=&quot;up_img&apos;+ fileId +&apos;&quot; /&gt;&lt;input type=&quot;button&quot; class=&quot;btn btn-primary click-check-img&quot; onclick=&quot;$(this).prev().click();&quot; value=&quot;点击选择图片&quot; /&gt;&lt;/div&gt;&apos;)
         .appendTo($(&quot;#uploadfiledemoform&quot;));
         //为该按钮调用uploadPreview方法：
         new uploadPreview({ UpBtn: &quot;up_img&quot;+ imgDivId +&quot;&quot;, DivShow: &quot;imgdiv&quot;+ imgShowId +&quot;&quot;, ImgShow: &quot;imgShow&quot;+ fileId +&quot;&quot; });
         imgDivId++;
         imgShowId++;
         fileId++;
         count++;

            }
     });

     $(&quot;#add-img&quot;).click(function(){
         $preview = $(&quot;.preview&quot;).last().children(&quot;div&quot;).children(&quot;img&quot;);        
         if(count&lt;=7){                  
         $(&apos;&lt;div class=&quot;preview&quot;&gt;&lt;input type=&quot;button&quot; class=&quot;del&quot; /&gt;&lt;div id=&quot;imgdiv&apos;+ imgDivId +&apos;&quot;&gt;&lt;img id=&quot;imgShow&apos;+ imgShowId +&apos;&quot; width=&quot;100&quot; height=&quot;100&quot; /&gt;&lt;/div&gt;&lt;input  class=&quot;file&quot;  name=&quot;file&quot; type=&quot;file&quot; id=&quot;up_img&apos;+ fileId +&apos;&quot; /&gt;&lt;input type=&quot;button&quot; class=&quot;btn btn-primary click-check-img&quot; onclick=&quot;$(this).prev().click();&quot; value=&quot;点击选择图片&quot; /&gt;&lt;/div&gt;&apos;)
         .appendTo($preview.parent().parent().parent());
         //为该按钮调用uploadPreview方法：
         new uploadPreview({ UpBtn: &quot;up_img&quot;+ imgDivId +&quot;&quot;, DivShow: &quot;imgdiv&quot;+ imgShowId +&quot;&quot;, ImgShow: &quot;imgShow&quot;+ fileId +&quot;&quot; });
         imgDivId++;
         imgShowId++;
         fileId++;
         count++;
         }
         else 
         if(count&gt;7){
             alert(&quot;最多只能选择八张图片&quot;);            
         }
     });
     //页面方法结束
 })
&lt;/script&gt;
&lt;/html&gt;
</code></pre>
    </div>

    <div class="post-footer">   
        <div>
            
                转载声明: 转载文章均已标明原作者及引用地址，侵删请联系。
            
        </div>
        <div>
            
                License: <a href="https://creativecommons.org/licenses/by-nc-nd/3.0/" target="_blank">
知识共享署名-非商业性使用-禁止演绎 3.0 未本地化版本许可协议（CC BY-NC-ND 3.0）
</a>
            
        </div>  
    </div>
</article>

<div class="article-nav prev-next-wrap clearfix">
    
        <a href="/wenjing/2017/09/23/20170923_04/" class="pre-post btn btn-default"><i class="fa fa-angle-left fa-fw"></i>上一篇</a>
    
    
        <a href="/wenjing/2017/09/23/20170923_02/" class="next-post btn btn-default">下一篇<i class="fa fa-angle-right fa-fw"></i></a>
    
</div>


    <div id="comments">
        
    <div id="uyan_frame"></div>
    <script type="text/javascript" src="http://v2.uyan.cc/code/uyan.js?uid=1966422"></script>








    </div>





                </main>
                
    <aside class="col-md-4 sidebar">
        
        
    <div class="widget notification">
        <h3 class="title">网站公告</h3>
        <div>
            <p>博客主题使用hexo-theme-snippet<br>
主题下载地址：<a href="https://github.com/shenliyang/hexo-theme-snippet"
title="fork me" target="_blank">Snippet主题</a></p>
        </div>
    </div>

        
        
    <div class="widget">
        <h3 class="title">Categories</h3>
        <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/wenjing/categories/fe/"><i class="fa" aria-hidden="true">前端</i></a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/wenjing/categories/re/"><i class="fa" aria-hidden="true">资源</i></a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link current" href="/wenjing/categories/ie/"><i class="fa" aria-hidden="true">随笔</i></a><span class="category-list-count">2</span></li></ul>
    </div>


        
        
    <div class="widget">
      <h3 class="title">Archives</h3>
        <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/wenjing/archives/2017/09/"><i class="fa" aria-hidden="true">September 2017</i></a><span class="archive-list-count">9</span></li></ul>
    </div>


        
        
  <div class="widget">
    <h3 class="title">Tag Cloud</h3>
    <div class="content tag-cloud">
      
        <a href="undefinedtags/IOS-APP/" style="font-size: 1em;">IOS APP</a> <a href="undefinedtags/第一篇/" style="font-size: 1em;">第一篇</a> <a href="undefinedtags/耦合-图解/" style="font-size: 1em;">耦合 - 图解</a> <a href="undefinedtags/parseInt-面试/" style="font-size: 1em;">parseInt - 面试</a> <a href="undefinedtags/前端/" style="font-size: 1em;">前端</a> <a href="undefinedtags/随笔/" style="font-size: 1em;">随笔</a> <a href="undefinedtags/HTTP2/" style="font-size: 1em;">HTTP2</a> <a href="undefinedtags/常见问题/" style="font-size: 1em;">常见问题</a> <a href="undefinedtags/IE/" style="font-size: 1em;">IE</a> <a href="undefinedtags/escape-encodeURI-encodeURIComponent/" style="font-size: 1em;">escape - encodeURI - encodeURIComponent</a> <a href="undefinedtags/2017/" style="font-size: 1em;">2017</a> <a href="undefinedtags/EXIF/" style="font-size: 1em;">EXIF</a>
    </div>
  </div>


        
        
    <div class="widget">
        <h3 class="title">Friends</h3>
        <div class="content friends-link">
        
            <a href="https://www.zhihu.com/people/huo-lan-si-liu-su/activities" class="fa" target="_blank">知乎</a>
        
            <a href="1016685879@qq.com" class="fa" target="_blank">QQ邮箱</a>
        
        </div>
    </div>


        
    </aside>

            </div>
        </div>
    </section>
    <footer class="main-footer">
    <div class="container">
        <div class="row">
        </div>
    </div>
</footer>






    <div class="copyright">
    <div class="container">
        <div class="row">
            <div class="col-sm-12"> 
                <span>Copyright &copy; 2017 
                </span> | 
                <span>
                    Powered by <a href="//hexo.io" class="copyright-links" target="_blank" rel="nofollow">Hexo</a>
                </span> | 
                <span>
                    Theme by <a href="//github.com/shenliyang/hexo-theme-snippet.git" class="copyright-links" target="_blank" rel="nofollow">Snippet</a>
                </span>
            </div>
        </div>
    </div>
</div>

  <script src="/wenjing/assets/highlight.pack.js?rev=@@hash"></script>
  <script>
    hljs.initHighlightingOnLoad(); //初始化代码高亮 
  </script>

<script src="/wenjing/js/app.js?rev=@@hash"></script>

</body>
</html>